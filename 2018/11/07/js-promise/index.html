<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Noah Xu"><title>å¼‚æ­¥ç¼–ç¨‹ä¹‹ Promise Â· ç”µå­æœˆäº®</title><meta name="description" content="Promise çš„åŠŸèƒ½æ˜¯å°†å¤æ‚çš„å¼‚æ­¥å¤„ç†é€šè¿‡ç‰¹å®šçš„æ¥å£è¿›è¡Œæ¨¡å¼åŒ–ã€‚
Promise ç®€ä»‹åˆ›å»ºä¸€ä¸ª promise å¯¹è±¡var promise = new Promise(function(resolve,reject){
    //å¼‚æ­¥å¤„ç†
    //å¤„ç†ç»“æŸåï¼Œè°ƒç”¨resolveæˆ–reject"><meta name="keywords" content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><link rel="stylesheet" href="/css/prism.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title"></a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">Electronic Moon</a></h1></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">é¦–é </a></li><li><a href="/archives">æ­¸æª”</a></li><li><a href="/tags">æ¨™ç±¤</a></li><li><a href="/resume/resume.html">ç®€å†</a></li><li class="soc"><a href="https://github.com/xhdnoah" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="http://xhdnoah.github.io/atom.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2019&nbsp;<a target="_blank" href="http://xhdnoah.github.io" rel="noopener noreferrer">Noah Xu</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>å¼‚æ­¥ç¼–ç¨‹ä¹‹ Promise</a></p><p class="post-meta"><span class="date meta-item">ç™¼ä½ˆæ–¼&nbsp;2018-11-07</span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/tags/JavaScript/" title="JavaScript" class="a-tag">JavaScript</a><span>&nbsp;</span></span></p><p class="post-abstract"></p><p>Promise çš„åŠŸèƒ½æ˜¯å°†å¤æ‚çš„å¼‚æ­¥å¤„ç†é€šè¿‡ç‰¹å®šçš„æ¥å£è¿›è¡Œæ¨¡å¼åŒ–ã€‚</p><h2 id="Promise-ç®€ä»‹"><a href="#Promise-ç®€ä»‹" class="headerlink" title="Promise ç®€ä»‹"></a>Promise ç®€ä»‹</h2><h3 id="åˆ›å»ºä¸€ä¸ª-promise-å¯¹è±¡"><a href="#åˆ›å»ºä¸€ä¸ª-promise-å¯¹è±¡" class="headerlink" title="åˆ›å»ºä¸€ä¸ª promise å¯¹è±¡"></a>åˆ›å»ºä¸€ä¸ª <code>promise</code> å¯¹è±¡</h3><pre><code>var promise = new Promise(function(resolve,reject){
    //å¼‚æ­¥å¤„ç†
    //å¤„ç†ç»“æŸåï¼Œè°ƒç”¨resolveæˆ–reject
});
</code></pre><h3 id="Instance-Method"><a href="#Instance-Method" class="headerlink" title="Instance Method"></a>Instance Method</h3><p>è®¾ç½®<code>promise</code>æ–°å¯¹è±¡çš„å€¼ä¸º resolve\reject æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>promise.then()</code>å®ä¾‹æ–¹æ³•<br><code>promise.then(onFulfilled,onRejected);</code></p><ul><li>resolve: <code>onFulfilled</code> è¢«è°ƒç”¨</li><li>reject:<code>onRejected</code> è¢«è°ƒç”¨</li></ul><h3 id="Static-Method"><a href="#Static-Method" class="headerlink" title="Static Method"></a>Static Method</h3><p>å…¨å±€å¯¹è±¡<code>Promise</code> è¿˜æ‹¥æœ‰ä¸€äº›é™æ€æ–¹æ³•ï¼š<code>Promise.all(),Promise.resolve()ç­‰</code></p><h2 id="Promise-Workflow"><a href="#Promise-Workflow" class="headerlink" title="Promise Workflow"></a>Promise Workflow</h2><pre><code>function asyncFunction(){
    return new Promise(function(resolve,reject){
        setTimeout(function(){
            resolve(â€˜Async Hello Worldâ€™);
        },16);
    });
}

asyncFunction().then(function(value){
    console.log(value);    //=&gt;â€™Async Hello Worldâ€™
}).catch(function(error){
    console.log(error);
});
</code></pre><p><code>asyncFunction</code> å‡½æ•°è¿”å›ä¸€ä¸ª promise å¯¹è±¡ï¼Œæˆ‘ä»¬è°ƒç”¨å®ƒçš„<code>then</code>æ–¹æ³•æ¥è®¾ç½®æ­£å¸¸æ—¶çš„å›è°ƒå‡½æ•°ï¼Œ<code>catch</code>æ–¹æ³•è®¾ç½®é”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ï¼›å¦‚æœåªä½¿ç”¨<code>then</code> æ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥<code>onFulfilled,onRejected</code>:</p><pre><code>asyncFunction().then(function(value){
    console.log(value);
},function(error){
    console.log(error);
});
</code></pre><h2 id="Promise-çš„çŠ¶æ€"><a href="#Promise-çš„çŠ¶æ€" class="headerlink" title="Promise çš„çŠ¶æ€"></a>Promise çš„çŠ¶æ€</h2><p>Promise å¯¹è±¡çš„çŠ¶æ€ï¼Œä» Pending è½¬ä¸º Fulfilled æˆ– Rejected åï¼Œå°±ä¸ä¼šå†å‘ç”Ÿå˜åŒ–ã€‚<br>å½“ Promise å¯¹è±¡çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç”¨<code>then</code>å®šä¹‰åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡çš„å‡½æ•°ã€‚</p><h2 id="ç¼–å†™-Promise-ä»£ç "><a href="#ç¼–å†™-Promise-ä»£ç " class="headerlink" title="ç¼–å†™ Promise ä»£ç "></a>ç¼–å†™ Promise ä»£ç </h2><h3 id="åˆ›å»º-XHR-çš„-promise-å¯¹è±¡"><a href="#åˆ›å»º-XHR-çš„-promise-å¯¹è±¡" class="headerlink" title="åˆ›å»º XHR çš„ promise å¯¹è±¡"></a>åˆ›å»º XHR çš„ promise å¯¹è±¡</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª Promise æŠŠ XHR å¤„ç†åŒ…è£…èµ·æ¥çš„æ¯ä¸º<code>getURL</code>çš„å‡½æ•°</p><pre><code>function getURL(URL){
    return new Promise(function(resolve,reject){
        var req = new XHLHttpRequest();
        req.open(â€˜GETâ€™,URL,true);
        req.onload = function(){
            if(req.status === 200){
            resolve(req.responseText);
            } else {
                reject(new Error(req.statusText));
            }
        };
        req.onerror = function(){
            reject(new Error(req.statusText));
        };
        req.send();
    });
}

//è¿è¡Œå®ä¾‹
var URL = â€œhttp://httpbin.org/getâ€;
getURL(URL).then(function onFulfilled(value){
    console.log(value);
}).catch(function onRejected(error){
    console.error(error);
});
</code></pre><p>å‘ç”Ÿé”™è¯¯æ—¶è¦åƒè¿™æ ·<code>reject(new Error(req.statusText));</code>åˆ›å»ºä¸€ä¸ª Error å¯¹è±¡å…·ä½“çš„å€¼ä¼ è¿›å»ã€‚</p><h1 id="å®æˆ˜-Promise"><a href="#å®æˆ˜-Promise" class="headerlink" title="å®æˆ˜ Promise"></a>å®æˆ˜ Promise</h1><h2 id="Promise-resolve"><a href="#Promise-resolve" class="headerlink" title="Promise.resolve"></a>Promise.resolve</h2><p>é™æ€æ–¹æ³•<code>Promise.resolve(value)</code>å¯ä»¥è®¤ä¸ºæ˜¯ <code>new Promise()</code>æ–¹æ³•çš„å¿«æ·æ–¹å¼</p><pre><code>Promise.resolve(42);
// å¯ä»¥è®¤ä¸ºæ˜¯ğŸ‘‡ä»£ç çš„è¯­æ³•ç³–
new Promise(function(resolve){
    resolve(42);    //è¿™é‡Œä¼šè®©Promiseå¯¹è±¡ç«‹å³è¿›å…¥ç¡®å®šçŠ¶æ€
});
</code></pre><p>æ–¹æ³•<code>Promise.resolve(value);</code>çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ª Promise å¯¹è±¡</p><pre><code>Promise.resolve(42).then(function(value){
    console.log(value);
});
</code></pre><h2 id="Thenable"><a href="#Thenable" class="headerlink" title="Thenable"></a>Thenable</h2><p><code>Promise.resolve</code>å¯ä»¥å°† thenable å¯¹è±¡è½¬æ¢ä¸º promise å¯¹è±¡<br>å› ä¸º<code>jQuery.ajax()</code> çš„è¿”å›å€¼æ˜¯ jqXHR Object å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å…·æœ‰<code>.then</code>æ–¹æ³•ã€‚</p><pre><code>var promise = Promise.resolve($.ajax(â€˜/json/comment.jsonâ€™));// =&gt; promise å¯¹è±¡
promise.then(function(value){
    console.log(value);
});
</code></pre><h2 id="Promise-reject"><a href="#Promise-reject" class="headerlink" title="Promise.reject"></a>Promise.reject</h2><pre><code>Promise.reject(new Error(â€œError!â€))
// è®¤ä¸ºæ˜¯ğŸ‘‡ä»£ç çš„è¯­æ³•ç³–
new Promise(function(resolve,reject){
    reject(new Error(â€œError!â€));
})
</code></pre><h2 id="Promise-å¼‚æ­¥æ“ä½œ"><a href="#Promise-å¼‚æ­¥æ“ä½œ" class="headerlink" title="Promise å¼‚æ­¥æ“ä½œ"></a>Promise å¼‚æ­¥æ“ä½œ</h2><p><code>Promise.then</code>ä¸­æŒ‡å®šçš„æ–¹æ³•è°ƒç”¨æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œä¸ºä»€ä¹ˆå¯ä»¥ä»¥åŒæ­¥æ–¹å¼è°ƒç”¨çš„å•Šå‡½æ•°å†œæˆ·ï¼Œéè¦ä½¿ç”¨å¼‚æ­¥çš„è°ƒç”¨æ–¹å¼å‘¢ï¼Ÿ</p><p>åœ¨ Effective Javascript 67 é¡¹</p><ul><li>ç»å¯¹ä¸èƒ½å¯¹å¼‚æ­¥å›è°ƒå‡½æ•°ï¼ˆå³ä½¿æ•°æ®å·²ç»å°±ç»ªï¼‰è¿›è¡ŒåŒæ­¥è°ƒç”¨</li><li>å¦‚æœå¯¹å¼‚æ­¥å›è°ƒå‡½æ•°è¿›è¡ŒåŒæ­¥è°ƒç”¨çš„è¯ï¼Œå¤„ç†é¡ºåºå¯èƒ½ä¼šä¸é¢„æœŸä¸ç¬¦ï¼Œè¿˜å¯èƒ½å¯¼è‡´æ ˆæº¢å‡ºæˆ–å¼‚å¸¸å¤„ç†é”™ä¹±ç­‰é—®é¢˜</li><li>å¦‚æœæƒ³åœ¨å°†æ¥æŸæ—¶åˆ»è°ƒç”¨å¼‚æ­¥å›è°ƒå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>setTimeout</code>ç­‰å¼‚æ­¥ APIã€‚</li></ul><p>å› æ­¤è§„å®š Promise åªèƒ½ä½¿ç”¨å¼‚æ­¥è°ƒç”¨æ–¹å¼ã€‚</p><p></p></div><div class="share"><span>åˆ†äº«åˆ°</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a href="http://twitter.com/home?status=http://xhdnoah.github.io/2018/11/07/js-promise/%20ç”µå­æœˆäº®%20å¼‚æ­¥ç¼–ç¨‹ä¹‹ Promise" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2018/11/07/ajax/" title="ajax-learning"><i class="fa fa-angle-double-left"></i>&nbsp;ä¸Šä¸€ç¯‡: ajax-learning</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/2018/11/07/æ­£åˆ™è¡¨è¾¾å¼/" title="æ­£åˆ™è¡¨è¾¾å¼ç¬”è®°">ä¸‹ä¸€ç¯‡: æ­£åˆ™è¡¨è¾¾å¼ç¬”è®°&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2019&nbsp;<a target="_blank" href="http://xhdnoah.github.io" rel="noopener noreferrer">Noah Xu</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="https://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script><script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script><script src="https://cdn.bootcss.com/jquery-migrate/1.2.1/jquery-migrate.min.js"></script><script src="https://cdn.bootcss.com/jquery.appear/0.4.1/jquery.appear.js"></script><script src="/js/typography.js"></script></body></html>